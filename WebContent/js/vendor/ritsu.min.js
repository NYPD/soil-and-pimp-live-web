/* ritsu.js v1.3.1 
 * Created 2018-03-23
 * Licensed under the MIT license
 * Source code can be found here: https://github.com/NYPD/ritsu 
 */

var ritsu = (function() {
var rules=function(){var a=[],b=function(b){for(var c=Array.isArray(b),d=null,e=0;e<a.length;e++){if(!(c?-1===b.indexOf(a[e].ruleClass):a[e].ruleClass!==b)){d=a[e];break}}return d},c=function(a,b,c,d){var f=Array.isArray(a),g="object"==typeof a&&!f;f||g?(g&&(a=[a]),a.forEach(function(a){e(a.ruleType,a.ruleClass,a.validationFunction,a.errorMessage)})):e(a,b,c,d)},d=function(a,b,c,d){this.ruleType=a,this.ruleClass=b,this.validate=c,this.getErrorMessage=d},e=function(c,e,f,g){if("alpha"!==c&&"numeric"!==c)throw new Error('The rule type for a new validation rule must be either "alpha" or "numeric"');if("string"!=typeof e)throw new Error("The rule class for a new validation rule is missing or is not of type string");if("function"!=typeof f)throw new Error("The validation function for a new validation rule is missing or is not of type function");void 0===g&&(g=new Function("",'return "Invalid value";')),"string"==typeof g&&(g=new Function("",'return "'+g+'";'));var h=b(e);if(null!==h){var i=a.indexOf(h);a.splice(i,1)}a.push(new d(c,e,f,g))},f=function(a){var b=a.value,c=a.hasAttribute("data-no-space");return new RegExp("^([A-Za-z@.-])+$".replace(/@/g,c?"":"\\s")).test(b)},g=function(a){return/(^\d{5}([\s-]?\d{4})?$)|(^[ABCEGHJKLMNPRSTVXY]{1}\d{1}[A-Z]{1} ?\d{1}[A-Z]{1}\d{1}$)/.test(a.value)},h=function(a){var b=a.value,c=a.hasAttribute("data-no-space");return new RegExp("^([a-zA-Z0-9@]+)$".replace(/@/g,c?"":"\\s")).test(b)},i=function(a){return/^(\S+@\S+\.\S+)$/.test(a.value)},j=function(a){var b=a.value,c=a.hasAttribute("data-no-thousands-separator"),d=/^-?(([\d]{1,3}(,{1}[\d]{3})*)|[\d]+)$/.test(b);return c&&(d=d&&-1===b.indexOf(",")),d},k=function(a){var b="Enter a whole number",c=a.hasAttribute("min"),d=a.hasAttribute("max");return c&&d?b=b+" from "+a.getAttribute("min")+" to "+a.getAttribute("max"):c?b=b+" greater or equal to "+a.getAttribute("min"):d&&(b=b+" lesser or equal to "+a.getAttribute("max")),b},l=function(a){var b=a.value,c=a.hasAttribute("data-no-thousands-separator"),d=a.getAttribute("data-decimal-max");null===d&&(d=2);var e="^-?((([\\d]{1,3}(,[\\d]{3})*)+(\\.[\\d]{1,decimalPlaces})?)|[\\d]+(\\.[\\d]{1,decimalPlaces})?)$",f=new RegExp(e.replace(/decimalPlaces/g,d)),g=f.test(b);return c&&(g=g&&-1===b.indexOf(",")),g},m=function(a){var b="Please enter a number",c=a.hasAttribute("min"),d=a.hasAttribute("max");return b+=" with "+(a.hasAttribute("data-decimal-max")?a.getAttribute("data-decimal-max"):2)+" decimal places max",c&&d?b=b+" and from "+a.getAttribute("min")+" to "+a.getAttribute("max"):c?b=b+" and greater or equal to "+a.getAttribute("min"):d&&(b=b+" and lesser or equal to "+a.getAttribute("max")),b},n=function(a){return console.warn("numeric-full-year has been deprecated since v1.3.0. Use numeric-whole instead and specify a min/max on the element"),/^(\d{4})$/.test(a.value)},o=function(a){var b="Please enter a 4 digit year",c=a.hasAttribute("min"),d=a.hasAttribute("max");return c&&d?b=b+" from "+a.getAttribute("min")+" to "+a.getAttribute("max"):c?b=b+" greater or equal to "+a.getAttribute("min"):d&&(b=b+" lesser or equal to "+a.getAttribute("max")),b},p=function(a){return null!==$(a).datepicker("getDate")};return e("alpha","alpha-only",f,"Only letters, spaces, hypens, and periods are allowed"),e("alpha","alpha-zip",g,"Enter a valid zip code"),e("alpha","alpha-numeric",h,"Enter only alphanumeric characters"),e("alpha","alpha-email",i,"Make sure the email is correct"),e("numeric","numeric-whole",j,k),e("numeric","numeric-decimal",l,m),e("numeric","numeric-full-year",n,o),e("numeric","numeric-jquery-date",p,"Please select a date from the date picker"),{getRuleByRuleClass:b,addValidationRule:c}},validation=function(a){var b=function(a){var b=!0;if("hidden"===a.type)return b;var c=a.classList.contains("alpha"),g=a.classList.contains("numeric"),h="file"===a.type,i=a.hasAttribute("required"),j=a.value,k=void 0===j||""===j.trim(),l=a.getAttribute("pattern");if(null!==l){if(k&&!i)return b;var m;try{m=new RegExp(l,"u")}catch(a){m=new RegExp(l)}return m.test(j)}return!k||i||h?(c&&(b=e(a)),g&&(b=f(a)),h&&(b=d(a)),c||g||h||!i||(b=!k),b):b},c=function(a){var b=-1===a.selectedIndex?void 0:a.options[a.selectedIndex].value,c=a.hasAttribute("required"),d=void 0===b||""===b.trim();return d&&!c||!d},d=function(a){var b=!0;if(!a.hasAttribute("required"))return b;var c=a.getAttribute("data-simple-file-hash"),d=!(null!==c&&""!==c.trim());return 0===a.files.length&&d&&(b=!1),b},e=function(b){var c=!0,d=(b.getAttribute("pattern"),b.getAttribute("class"));if(null===d||""===d)return c;var e=d.split(" "),f=a.getRuleByRuleClass(e);return null===f?c:c=f.validate(b)},f=function(b){var c=!0,d=b.getAttribute("class"),e=d?d.split(" "):"",f=a.getRuleByRuleClass(e);if(null!==f&&(c=f.validate(b)),c){var g=Number(b.value.replace(",",""));if(isNaN(g))return c;var h=b.getAttribute("min"),i=b.getAttribute("max"),j=""===h||null===h?null:Number(h),k=""===i||null===i?null:Number(i),l=null!==j,m=null!==k;l&&m?c=g>=j&&g<=k:l?c=g>=j:m&&(c=g<=k)}return c};return{validateElement:function(a){var d=!0;if(!0===a.disabled)return d;var e=["INPUT","TEXTAREA"].indexOf(a.nodeName)>-1,f="SELECT"===a.nodeName;return e&&(d=b(a)),f&&(d=c(a)),d}}},core=function(a,b){var c="undefined"!=typeof jQuery,d={useBootstrap3Stlying:!1,autoMarkInvalidFields:!0,autoShowErrorMessages:!1,messageCallback:null},e=function(b){if("object"!=typeof b)throw new Error("Invalid options to initialize ritsu.js");if(d.useBootstrap3Stlying=void 0!==b.useBootstrap3Stlying&&b.useBootstrap3Stlying,d.autoMarkInvalidFields=void 0===b.autoMarkInvalidFields||b.autoMarkInvalidFields,d.autoShowErrorMessages=void 0!==b.autoShowErrorMessages&&b.autoShowErrorMessages,void 0===b.messageCallback)d.messageCallback=null;else{if("function"!=typeof b.messageCallback)throw new Error("messageCallback is not a function");d.messageCallback=b.messageCallback}var c=b.validationRules;return void 0!==c&&a.addValidationRule(c),this},f=function(a){return p(a).forEach(function(a){var b="checkbox"===a.type,c="radio"===a.type,d="file"===a.type;if(b||c)a.setAttribute("data-initial-value",a.checked);else if(d){var e=void 0!==a.getAttribute("data-simple-file-hash");if(e)return a.setAttribute("data-initial-value",a.getAttribute("data-simple-file-hash")),!0;var f=a.files.length>0,g=f?a.files[0].name+a.files[0].size:void 0;a.setAttribute("data-initial-value",g)}else a.setAttribute("data-initial-value",a.value)}),this},g=function(a){var b=p(a);return 0===b.length?null:b[0].getAttribute("data-initial-value")},h=function(a){for(var b=p(a),c=0;c<b.length;c++){var d=b[c];if(!!d.hasAttribute("data-initial-value")){var e="checkbox"===d.type,f="radio"===d.type,g="file"===d.type,h=d.getAttribute("data-initial-value");if(e||f)d.checked="true"==h;else if(g){var i=d.cloneNode(!0);i.removeAttribute("data-initial-value"),i.removeAttribute("data-simple-file-hash"),d.parentNode.replaceChild(i,d)}else d.value=h}}return this},i=function(a){var b=!1;return p(a).forEach(function(a){if(void 0===a.getAttribute("data-initial-value"))return!0;var c="checkbox"===a.type,d="radio"===a.type,e="file"===a.type,f=!1,g=a.getAttribute("data-initial-value");if(c||d)f=g!=""+a.checked;else if(e){var h=a.files.length>0;f=g!==(h?a.files[0].name+a.files[0].size:a.getAttribute("data-simple-file-hash"))}else f=g!==a.value;return f?(b=!0,!1):void 0}),b},j=function(a,c){var e=void 0!==c,f=p(a),g=!0;return f.forEach(function(a){var f=!b.validateElement(a);(null!==d.messageCallback||e)&&(e?s(a,c,f):s(a,d.messageCallback,f)),f?(g=!1,a.setAttribute("data-invalid",!0)):(a.setAttribute("data-invalid",!1),null!==d.messageCallback||e||r(a))}),null!==d.messageCallback||e||t(f),g},k=function(a){return p(a).forEach(function(a){var b=d.useBootstrap3Stlying?q(a,"form-group"):a;null===b&&(b=a),"true"===a.getAttribute("data-invalid")?b.classList.add("has-error"):b.classList.remove("has-error")}),this},l=function(a){if(void 0===a)throw new Error("No selector passed in");var b=m(a);return void 0===b[0]?null:b[0]},m=function(a){var b=p(a),c=[];return b.forEach(function(a){"true"===a.getAttribute("data-invalid")&&c.push(u(a))}),c},n=function(a){var b=p(a),c={};return b.forEach(function(a){"true"===a.getAttribute("data-invalid")&&(c[a]=u(a))}),c},o=function(a,b){for(var c=p(a),e=void 0!==b,f=0;f<c.length;f++){var g=c[f],h="true"!==g.getAttribute("data-invalid");if(null!==d.messageCallback||e?s(g,e?b:d.messageCallback,!h):r(g),!h){var i=u(g);if(d.useBootstrap3Stlying){var j=q(g,"form-group"),k=j.querySelector(".help-block"),l=null!==k,m=document.createElement("em");m.innerHTML=i;var n=document.createElement("b");if(l){var o=document.createElement("br");o.className="ritsu-error",n.className="ritsu-error",n.appendChild(m),n.appendChild(o),k.insertBefore(n,k.firstChild)}else{n.appendChild(m);var t=document.createElement("span");t.className="help-block ritsu-error",t.appendChild(n),g.parentElement.appendChild(t)}}else{var v=g.getAttribute("id"),w=document.createElement("label");w.className="error-label",w.htmlFor=v||"",w.innerHTML=i;(null===q(g,"form-group")?g.parentElement:q(g,"form-group")).appendChild(w)}}}return this},p=function(a){if(!!c&&a instanceof jQuery&&(a=a.get()),void 0===a&&(a=Array.prototype.slice.call(document.querySelectorAll("input, textarea, select"))),"string"==typeof a&&(a=Array.prototype.slice.call(document.querySelectorAll(a))),(a instanceof NodeList||a instanceof HTMLCollection)&&(a=Array.prototype.slice.call(a)),!Array.isArray(a)&&(a=[a]),0===a.length)return[];var b=[];return a.forEach(function(a){-1===["INPUT","TEXTAREA","SELECT"].indexOf(a.nodeName)?b=b.concat(Array.prototype.slice.call(a.querySelectorAll("input, textarea, select"))):b.push(a)}),b},q=function(a,b){for(;a;){var c=a.parentElement;if(null!==c&&c.classList.contains(b))return c;a=c}return null},r=function(a){var b=null===q(a,"form-group")?a.parentElement:q(a,"form-group");null!==b&&Array.prototype.slice.call(b.querySelectorAll(d.useBootstrap3Stlying?".ritsu-error":".error-label, .warning-label")).forEach(function(a){a.parentElement.removeChild(a)})},s=function(a,b,c){b(a,c?u(a):null)},t=function(a){d.autoMarkInvalidFields&&k(a),d.autoShowErrorMessages&&o(a)},u=function(b){if("SELECT"===b.nodeName)return"Please select an option";if(b.hasAttribute("data-error-message"))return b.getAttribute("data-error-message");var c="Invalid Value",d=b.getAttribute("class");if(null===d||""===d)return c;var e=d.split(" "),f=a.getRuleByRuleClass(e);return null!==f&&(c=f.getErrorMessage(b)),c};return{version:"1.3.1",rules:a,initialize:e,storeInitialFormValues:f,getInitialFormValue:g,resetIntialFormValues:h,resetInitialFormValues:h,isFormDirty:i,validate:j,markInvalidFields:k,showErrorMessages:o,getErrorMessage:l,getErrorMessages:m,getErrorMessagesAsMap:n}};
var r = rules(); return core(r, validation(r));
})();
